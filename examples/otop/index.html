<html>
 <header>
  <title>Onion Top</title>
  <script src="http://code.jquery.com/jquery-1.4.3.min.js"></script>
<style>
body{
	background: #555;
	font-family: sans-serif;
}

table{
	background: white;
	border-radius: 5px;
	-moz-border-radius: 5px;
	width: 100%;
}

table th{
	background: #eee;
}

table tbody tr.removed{
	background: red;
}

table tbody tr.new{
	background: green;
}

table tbody tr:hover{
	background: yellow;
}

</style>
 </header>
<body>
<h1>Onion Top</h1>

<table id="process">
<thead>
<tr><th>PID</th><th>Command</th></tr>
</thead>
<tbody>
</tbody>
</table>


<script>
$(document).ready(function(){
	updateTop()
})

/**
 * @short Updates the top list.
 */
updateTop = function(){
	var p=$('#process tbody')
	var X=window.pageXOffset
	var Y=window.pageYOffset
	$.get('/ps/', function(d){
		$('tr.removed').remove()
		var lines=p.children('tr')
		lines.removeClass('new','slow')
		$(d.split('\n')).each(function(){
			var l=this.split(' ')
			if (l[0]){
				if (lines.filter('#'+l[0]).length){ // already here
					lines=lines.not('#'+l[0])
				}
				else{
					var tr=$('<tr>').attr('id',l[0]).addClass('new').fadeIn('slow')
					tr.append($('<td>').text(l[0]))
					tr.append($('<td>').text(l[1]))
					p.append(tr)
				}
			}
		})
		lines.addClass('removed').fadeOut('slow')
	},'plain')

	window.scrollTo(X,Y)
	setTimeout(updateTop,2*1000)
}
</script>

</body>
