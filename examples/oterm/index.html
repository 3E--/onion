<html>
 <head>
  <title>Oterm -- Onion based terminal emulator over HTTP</title>
  <script src="jquery-1.4.3.min.js"></script>
  <style>
body{
	font-family: sans-serif;
	background: white;
	color: black;
	margin: 2em;
}

a{
	color: red;
	text-decoration: none;
}
  </style>
 </head>
<body>

<h1>Onion Term</h1>

Onion term is a tst application for the <a href="http://www.coralbits.com/libonion/">onion http library</a>.

<h2 id="sessions_title">Loading session information...</h2>

<ul id="current_sessions">
</ul>

<h3><a href="javascript:newTerm()">Create a new remote session</a></h3>


<script>
newTerm = function(){
	$.get('term/new', function(data){
/*
		var a=$('<a>').target(data.id).href('term?id='+data.id)
		$(document).append(a)
		a.click()
		a.delete()
*/
		//sessionStatus(data)
		updateSessionStatus()
	})
}

/// Updates the list of sessions
sessionStatus = function(data){
	$('#sessions_title').text('Current sessions')
	var s=$('#current_sessions')
	for(var id in data){
		var a=$('<a>').text(id+' '+data[id].pid).attr('target',id).attr('id',id)
		a.attr('href','term/'+id+'/')
		s.append($('<li>').append(a))
	}
}

/// Requests the list of sessions
updateSessionStatus = function(){
	$.get('term/status', sessionStatus,'json')
}

$(document).ready(function(){
	$(document).ajaxError(function(){
		$('#sessions_title').text('Could not get session information. Check server is properly working.')
		alert("Error loading session status data");
	})

	updateSessionStatus()
})
</script>

</body>
</html>
